"use strict";

var cov_2hqcrqw2hf = function () {
  var path = "/home/local/pyykkomi/liiga/backend/services/common/index.js";
  var hash = "478d775253584c1d27188189b50189905d913384";
  var global = new Function("return this")();
  var gcv = "__coverage__";
  var coverageData = {
    path: "/home/local/pyykkomi/liiga/backend/services/common/index.js",
    statementMap: {
      "0": {
        start: {
          line: 3,
          column: 22
        },
        end: {
          line: 13,
          column: 1
        }
      },
      "1": {
        start: {
          line: 4,
          column: 2
        },
        end: {
          line: 6,
          column: 3
        }
      },
      "2": {
        start: {
          line: 5,
          column: 4
        },
        end: {
          line: 5,
          column: 47
        }
      },
      "3": {
        start: {
          line: 8,
          column: 17
        },
        end: {
          line: 8,
          column: 36
        }
      },
      "4": {
        start: {
          line: 10,
          column: 2
        },
        end: {
          line: 12,
          column: 6
        }
      },
      "5": {
        start: {
          line: 11,
          column: 48
        },
        end: {
          line: 11,
          column: 85
        }
      },
      "6": {
        start: {
          line: 15,
          column: 26
        },
        end: {
          line: 19,
          column: 1
        }
      },
      "7": {
        start: {
          line: 16,
          column: 2
        },
        end: {
          line: 18,
          column: 3
        }
      },
      "8": {
        start: {
          line: 17,
          column: 50
        },
        end: {
          line: 17,
          column: 73
        }
      },
      "9": {
        start: {
          line: 21,
          column: 22
        },
        end: {
          line: 36,
          column: 1
        }
      },
      "10": {
        start: {
          line: 22,
          column: 2
        },
        end: {
          line: 27,
          column: 3
        }
      },
      "11": {
        start: {
          line: 23,
          column: 4
        },
        end: {
          line: 26,
          column: 40
        }
      },
      "12": {
        start: {
          line: 29,
          column: 2
        },
        end: {
          line: 35,
          column: 6
        }
      },
      "13": {
        start: {
          line: 31,
          column: 6
        },
        end: {
          line: 34,
          column: 36
        }
      },
      "14": {
        start: {
          line: 38,
          column: 31
        },
        end: {
          line: 49,
          column: 1
        }
      },
      "15": {
        start: {
          line: 39,
          column: 23
        },
        end: {
          line: 39,
          column: 56
        }
      },
      "16": {
        start: {
          line: 41,
          column: 2
        },
        end: {
          line: 48,
          column: 3
        }
      },
      "17": {
        start: {
          line: 43,
          column: 64
        },
        end: {
          line: 43,
          column: 87
        }
      },
      "18": {
        start: {
          line: 45,
          column: 4
        },
        end: {
          line: 45,
          column: 60
        }
      },
      "19": {
        start: {
          line: 47,
          column: 4
        },
        end: {
          line: 47,
          column: 13
        }
      },
      "20": {
        start: {
          line: 51,
          column: 31
        },
        end: {
          line: 62,
          column: 1
        }
      },
      "21": {
        start: {
          line: 52,
          column: 27
        },
        end: {
          line: 52,
          column: 42
        }
      },
      "22": {
        start: {
          line: 54,
          column: 2
        },
        end: {
          line: 61,
          column: 3
        }
      },
      "23": {
        start: {
          line: 56,
          column: 29
        },
        end: {
          line: 56,
          column: 56
        }
      },
      "24": {
        start: {
          line: 58,
          column: 4
        },
        end: {
          line: 58,
          column: 21
        }
      },
      "25": {
        start: {
          line: 60,
          column: 4
        },
        end: {
          line: 60,
          column: 15
        }
      }
    },
    fnMap: {
      "0": {
        name: "(anonymous_0)",
        decl: {
          start: {
            line: 3,
            column: 22
          },
          end: {
            line: 3,
            column: 23
          }
        },
        loc: {
          start: {
            line: 3,
            column: 58
          },
          end: {
            line: 13,
            column: 1
          }
        },
        line: 3
      },
      "1": {
        name: "(anonymous_1)",
        decl: {
          start: {
            line: 11,
            column: 33
          },
          end: {
            line: 11,
            column: 34
          }
        },
        loc: {
          start: {
            line: 11,
            column: 48
          },
          end: {
            line: 11,
            column: 85
          }
        },
        line: 11
      },
      "2": {
        name: "(anonymous_2)",
        decl: {
          start: {
            line: 15,
            column: 26
          },
          end: {
            line: 15,
            column: 27
          }
        },
        loc: {
          start: {
            line: 15,
            column: 64
          },
          end: {
            line: 19,
            column: 1
          }
        },
        line: 15
      },
      "3": {
        name: "(anonymous_3)",
        decl: {
          start: {
            line: 17,
            column: 32
          },
          end: {
            line: 17,
            column: 33
          }
        },
        loc: {
          start: {
            line: 17,
            column: 50
          },
          end: {
            line: 17,
            column: 73
          }
        },
        line: 17
      },
      "4": {
        name: "(anonymous_4)",
        decl: {
          start: {
            line: 21,
            column: 22
          },
          end: {
            line: 21,
            column: 23
          }
        },
        loc: {
          start: {
            line: 21,
            column: 69
          },
          end: {
            line: 36,
            column: 1
          }
        },
        line: 21
      },
      "5": {
        name: "(anonymous_5)",
        decl: {
          start: {
            line: 30,
            column: 31
          },
          end: {
            line: 30,
            column: 32
          }
        },
        loc: {
          start: {
            line: 31,
            column: 6
          },
          end: {
            line: 34,
            column: 36
          }
        },
        line: 31
      },
      "6": {
        name: "(anonymous_6)",
        decl: {
          start: {
            line: 38,
            column: 31
          },
          end: {
            line: 38,
            column: 32
          }
        },
        loc: {
          start: {
            line: 38,
            column: 41
          },
          end: {
            line: 49,
            column: 1
          }
        },
        line: 38
      },
      "7": {
        name: "(anonymous_7)",
        decl: {
          start: {
            line: 51,
            column: 31
          },
          end: {
            line: 51,
            column: 32
          }
        },
        loc: {
          start: {
            line: 51,
            column: 41
          },
          end: {
            line: 62,
            column: 1
          }
        },
        line: 51
      }
    },
    branchMap: {
      "0": {
        loc: {
          start: {
            line: 3,
            column: 43
          },
          end: {
            line: 3,
            column: 53
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 3,
            column: 49
          },
          end: {
            line: 3,
            column: 53
          }
        }],
        line: 3
      },
      "1": {
        loc: {
          start: {
            line: 4,
            column: 2
          },
          end: {
            line: 6,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 4,
            column: 2
          },
          end: {
            line: 6,
            column: 3
          }
        }, {
          start: {
            line: 4,
            column: 2
          },
          end: {
            line: 6,
            column: 3
          }
        }],
        line: 4
      },
      "2": {
        loc: {
          start: {
            line: 15,
            column: 49
          },
          end: {
            line: 15,
            column: 59
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 15,
            column: 55
          },
          end: {
            line: 15,
            column: 59
          }
        }],
        line: 15
      },
      "3": {
        loc: {
          start: {
            line: 21,
            column: 43
          },
          end: {
            line: 21,
            column: 53
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 21,
            column: 49
          },
          end: {
            line: 21,
            column: 53
          }
        }],
        line: 21
      },
      "4": {
        loc: {
          start: {
            line: 21,
            column: 55
          },
          end: {
            line: 21,
            column: 64
          }
        },
        type: "default-arg",
        locations: [{
          start: {
            line: 21,
            column: 60
          },
          end: {
            line: 21,
            column: 64
          }
        }],
        line: 21
      },
      "5": {
        loc: {
          start: {
            line: 22,
            column: 2
          },
          end: {
            line: 27,
            column: 3
          }
        },
        type: "if",
        locations: [{
          start: {
            line: 22,
            column: 2
          },
          end: {
            line: 27,
            column: 3
          }
        }, {
          start: {
            line: 22,
            column: 2
          },
          end: {
            line: 27,
            column: 3
          }
        }],
        line: 22
      }
    },
    s: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0,
      "8": 0,
      "9": 0,
      "10": 0,
      "11": 0,
      "12": 0,
      "13": 0,
      "14": 0,
      "15": 0,
      "16": 0,
      "17": 0,
      "18": 0,
      "19": 0,
      "20": 0,
      "21": 0,
      "22": 0,
      "23": 0,
      "24": 0,
      "25": 0
    },
    f: {
      "0": 0,
      "1": 0,
      "2": 0,
      "3": 0,
      "4": 0,
      "5": 0,
      "6": 0,
      "7": 0
    },
    b: {
      "0": [0],
      "1": [0, 0],
      "2": [0],
      "3": [0],
      "4": [0],
      "5": [0, 0]
    },
    _coverageSchema: "43e27e138ebf9cfc5966b082cf9a028302ed4184",
    hash: "478d775253584c1d27188189b50189905d913384"
  };
  var coverage = global[gcv] || (global[gcv] = {});

  if (coverage[path] && coverage[path].hash === hash) {
    return coverage[path];
  }

  return coverage[path] = coverageData;
}();

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.stripTournament = exports.splitSeasonName = exports.update = exports.insertMany = exports.insert = void 0;

var _lodash = _interopRequireDefault(require("lodash"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _objectDestructuringEmpty(obj) { if (obj == null) throw new TypeError("Cannot destructure undefined"); }

function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

function asyncGeneratorStep(gen, resolve, reject, _next, _throw, key, arg) { try { var info = gen[key](arg); var value = info.value; } catch (error) { reject(error); return; } if (info.done) { resolve(value); } else { Promise.resolve(value).then(_next, _throw); } }

function _asyncToGenerator(fn) { return function () { var self = this, args = arguments; return new Promise(function (resolve, reject) { var gen = fn.apply(self, args); function _next(value) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "next", value); } function _throw(err) { asyncGeneratorStep(gen, resolve, reject, _next, _throw, "throw", err); } _next(undefined); }); }; }

cov_2hqcrqw2hf.s[0]++;

var insert =
/*#__PURE__*/
function () {
  var _ref = _asyncToGenerator(
  /*#__PURE__*/
  regeneratorRuntime.mark(function _callee2(data, entity) {
    var trx,
        chunks,
        _args2 = arguments;
    return regeneratorRuntime.wrap(function _callee2$(_context2) {
      while (1) {
        switch (_context2.prev = _context2.next) {
          case 0:
            trx = _args2.length > 2 && _args2[2] !== undefined ? _args2[2] : (cov_2hqcrqw2hf.b[0][0]++, null);
            cov_2hqcrqw2hf.f[0]++;
            cov_2hqcrqw2hf.s[1]++;

            if (data instanceof Array) {
              _context2.next = 11;
              break;
            }

            cov_2hqcrqw2hf.b[1][0]++;
            cov_2hqcrqw2hf.s[2]++;
            _context2.next = 8;
            return entity.query(trx).insert(data);

          case 8:
            return _context2.abrupt("return", _context2.sent);

          case 11:
            cov_2hqcrqw2hf.b[1][1]++;

          case 12:
            chunks = (cov_2hqcrqw2hf.s[3]++, _lodash["default"].chunk(data, 1000));
            cov_2hqcrqw2hf.s[4]++;
            _context2.t0 = _lodash["default"];
            _context2.next = 17;
            return Promise.all(chunks.map(
            /*#__PURE__*/
            function () {
              var _ref2 = _asyncToGenerator(
              /*#__PURE__*/
              regeneratorRuntime.mark(function _callee(chunk) {
                return regeneratorRuntime.wrap(function _callee$(_context) {
                  while (1) {
                    switch (_context.prev = _context.next) {
                      case 0:
                        cov_2hqcrqw2hf.f[1]++;
                        cov_2hqcrqw2hf.s[5]++;
                        _context.next = 4;
                        return entity.query(trx).insert(chunk);

                      case 4:
                        return _context.abrupt("return", _context.sent);

                      case 5:
                      case "end":
                        return _context.stop();
                    }
                  }
                }, _callee);
              }));

              return function (_x3) {
                return _ref2.apply(this, arguments);
              };
            }()));

          case 17:
            _context2.t1 = _context2.sent;
            return _context2.abrupt("return", _context2.t0.flattenDepth.call(_context2.t0, _context2.t1, 1));

          case 19:
          case "end":
            return _context2.stop();
        }
      }
    }, _callee2);
  }));

  return function insert(_x, _x2) {
    return _ref.apply(this, arguments);
  };
}();

exports.insert = insert;
cov_2hqcrqw2hf.s[6]++;

var insertMany =
/*#__PURE__*/
function () {
  var _ref3 = _asyncToGenerator(
  /*#__PURE__*/
  regeneratorRuntime.mark(function _callee4(data, entities) {
    var trx,
        _args4 = arguments;
    return regeneratorRuntime.wrap(function _callee4$(_context4) {
      while (1) {
        switch (_context4.prev = _context4.next) {
          case 0:
            trx = _args4.length > 2 && _args4[2] !== undefined ? _args4[2] : (cov_2hqcrqw2hf.b[2][0]++, null);
            cov_2hqcrqw2hf.f[2]++;
            cov_2hqcrqw2hf.s[7]++;
            return _context4.abrupt("return", Promise.all(_lodash["default"].zip(data, entities).map(
            /*#__PURE__*/
            function () {
              var _ref5 = _asyncToGenerator(
              /*#__PURE__*/
              regeneratorRuntime.mark(function _callee3(_ref4) {
                var _ref6, d, e;

                return regeneratorRuntime.wrap(function _callee3$(_context3) {
                  while (1) {
                    switch (_context3.prev = _context3.next) {
                      case 0:
                        _ref6 = _slicedToArray(_ref4, 2), d = _ref6[0], e = _ref6[1];
                        cov_2hqcrqw2hf.f[3]++;
                        cov_2hqcrqw2hf.s[8]++;
                        _context3.next = 5;
                        return insert(d, e, trx);

                      case 5:
                        return _context3.abrupt("return", _context3.sent);

                      case 6:
                      case "end":
                        return _context3.stop();
                    }
                  }
                }, _callee3);
              }));

              return function (_x6) {
                return _ref5.apply(this, arguments);
              };
            }())));

          case 4:
          case "end":
            return _context4.stop();
        }
      }
    }, _callee4);
  }));

  return function insertMany(_x4, _x5) {
    return _ref3.apply(this, arguments);
  };
}();

exports.insertMany = insertMany;
cov_2hqcrqw2hf.s[9]++;

var update =
/*#__PURE__*/
function () {
  var _ref7 = _asyncToGenerator(
  /*#__PURE__*/
  regeneratorRuntime.mark(function _callee6(data, entity) {
    var trx,
        id,
        _args6 = arguments;
    return regeneratorRuntime.wrap(function _callee6$(_context6) {
      while (1) {
        switch (_context6.prev = _context6.next) {
          case 0:
            trx = _args6.length > 2 && _args6[2] !== undefined ? _args6[2] : (cov_2hqcrqw2hf.b[3][0]++, null);
            id = _args6.length > 3 && _args6[3] !== undefined ? _args6[3] : (cov_2hqcrqw2hf.b[4][0]++, 'id');
            cov_2hqcrqw2hf.f[4]++;
            cov_2hqcrqw2hf.s[10]++;

            if (data instanceof Array) {
              _context6.next = 12;
              break;
            }

            cov_2hqcrqw2hf.b[5][0]++;
            cov_2hqcrqw2hf.s[11]++;
            _context6.next = 9;
            return entity.query(trx).skipUndefined().patchAndFetchById(data[id], data);

          case 9:
            return _context6.abrupt("return", _context6.sent);

          case 12:
            cov_2hqcrqw2hf.b[5][1]++;

          case 13:
            cov_2hqcrqw2hf.s[12]++;
            _context6.t0 = _lodash["default"];
            _context6.next = 17;
            return Promise.all(data.map(
            /*#__PURE__*/
            function () {
              var _ref8 = _asyncToGenerator(
              /*#__PURE__*/
              regeneratorRuntime.mark(function _callee5(d) {
                return regeneratorRuntime.wrap(function _callee5$(_context5) {
                  while (1) {
                    switch (_context5.prev = _context5.next) {
                      case 0:
                        cov_2hqcrqw2hf.f[5]++;
                        cov_2hqcrqw2hf.s[13]++;
                        _context5.next = 4;
                        return entity.query(trx).skipUndefined().patchAndFetchById(d[id], d);

                      case 4:
                        return _context5.abrupt("return", _context5.sent);

                      case 5:
                      case "end":
                        return _context5.stop();
                    }
                  }
                }, _callee5);
              }));

              return function (_x9) {
                return _ref8.apply(this, arguments);
              };
            }()));

          case 17:
            _context6.t1 = _context6.sent;
            return _context6.abrupt("return", _context6.t0.flattenDepth.call(_context6.t0, _context6.t1, 1));

          case 19:
          case "end":
            return _context6.stop();
        }
      }
    }, _callee6);
  }));

  return function update(_x7, _x8) {
    return _ref7.apply(this, arguments);
  };
}();

exports.update = update;
cov_2hqcrqw2hf.s[14]++;

var splitSeasonName = function splitSeasonName(name) {
  cov_2hqcrqw2hf.f[6]++;
  var seasonRegExp = (cov_2hqcrqw2hf.s[15]++, /^(.*)\.\s+(.*) - (\d+)-?(\d+)?$/);
  cov_2hqcrqw2hf.s[16]++;

  try {
    // eslint-disable-next-line no-empty-pattern
    var _ref9 = (cov_2hqcrqw2hf.s[17]++, seasonRegExp.exec(name)),
        _ref10 = _slicedToArray(_ref9, 5);

    _objectDestructuringEmpty(_ref10[0]);

    var country = _ref10[1],
        tournamentName = _ref10[2],
        start_year = _ref10[3],
        end_year = _ref10[4];
    cov_2hqcrqw2hf.s[18]++;
    return {
      country: country,
      tournamentName: tournamentName,
      start_year: start_year,
      end_year: end_year
    };
  } catch (e) {
    cov_2hqcrqw2hf.s[19]++;
    return {};
  }
};

exports.splitSeasonName = splitSeasonName;
cov_2hqcrqw2hf.s[20]++;

var stripTournament = function stripTournament(name) {
  cov_2hqcrqw2hf.f[7]++;
  var tournamentRegExp = (cov_2hqcrqw2hf.s[21]++, /^.*\.\s+(.*)$/);
  cov_2hqcrqw2hf.s[22]++;

  try {
    // eslint-disable-next-line no-empty-pattern
    var _ref11 = (cov_2hqcrqw2hf.s[23]++, tournamentRegExp.exec(name)),
        _ref12 = _slicedToArray(_ref11, 2);

    _objectDestructuringEmpty(_ref12[0]);

    var seasonName = _ref12[1];
    cov_2hqcrqw2hf.s[24]++;
    return seasonName;
  } catch (e) {
    cov_2hqcrqw2hf.s[25]++;
    return null;
  }
};

exports.stripTournament = stripTournament;